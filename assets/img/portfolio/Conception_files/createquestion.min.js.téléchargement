function createQuestionLoadHandler(){var t,i,n;setDropdownPicto(),$(".btnSetWeights").click(function(){return ShowSetWeights(),!1}),$(".btnManageDictionaries").click(function(){return ShowManageDictionaries(),!1});$(".lnkScales").on("click",function(){return HideCustomTooltip(),ShowSetScales("0"),!1});$(".lnkScalesTab").click(function(){return ShowSetScales("1"),!1}),$(".lnkRestrictions").click(function(){return lnkRestrictions_ClientClick(),!1});$('input[type="checkbox"][id*="cbBasic"]').on("change",function(){$(this).prop("checked")&&$('input[type="checkbox"][id*="cbHideQuestion"]').prop("checked",!0)});$("#ctl00_dcq_cbUseNumericSlider").click(function(){var t,n,r,i;$(this).is(":checked")&&(t=$(".tbNbMin").val(),n=$(".tbNbMax").val(),t.length==0&&n.length==0?($(".tbNbMin").val(0),$(".tbNbMax").val(100)):(r=parseInt(t),i=parseInt(n),t.length==0?$(".tbNbMin").val(i-100):n.length==0&&$(".tbNbMax").val(r+100)))}),ShowHide($(".cbFixNbCols input"),$(".trNbCols")),$(".cbFixNbCols input").change(function(){ShowHide($(".cbFixNbCols input"),$(".trNbCols"))}),ShowHide($(".cbRestriction input"),$(".restrictions")),$(".cbRestriction input").change(function(){ShowHide($(".cbRestriction input"),$(".restrictions"))}),ShowHide($(".cbBasic input"),$(".basics"));$(".cbBasic input").on("change",function(){ShowHide($(".cbBasic input"),$(".basics"))});ShowHide($(".cbInstruction input"),$(".trInstruction")),$(".cbInstruction input").change(function(){ShowHide($(".cbInstruction input"),$(".trInstruction")),$(".trInstruction input").focus()}),ShowHide($(".cbAlert input"),$(".trAlert")),$(".cbAlert input").change(function(){ShowHide($(".cbAlert input"),$(".trAlert")),$(".trAlert input").focus()}),ShowHide($(".cbNumDecimal input"),$(".SpanDecimal")),$(".cbNumDecimal input").change(function(){ShowHide($(".cbNumDecimal input"),$(".SpanDecimal"))}),t=!0,$(".ddlCodeFormat").change(function(){$(".ddlCodeFormat option:selected").val()=="codetype_sized"?($(".trCodeTaille").show(),t||$(".tbCodeTaille").focus()):$(".trCodeTaille").hide(),$(".ddlCodeFormat option:selected").val()=="codetype_custom"?($(".trCodeRegex").show(),t||$(".tbCodeRegex").focus()):$(".trCodeRegex").hide()}),$(".ddlCodeFormat").change(),t=!1,$(".ddlMultiple").change(function(){$(".cbMultiple input").is(":checked")&&$(".ddlMultiple option:selected").val()=="fixed"?$("#ctl00_dcq_tbNbMultiple_wrapper").css("display","inline-block"):$("#ctl00_dcq_tbNbMultiple_wrapper").css("display","none")}),$(".ddlMultiple").change(),$(".cbMultiple input").change(function(){ShowHide($(".cbMultiple input"),$(".trMultiple")),$(".cbMultiple input").is(":checked")&&($(".ddlMultiple option:selected").val()=="fixed"&&$("#ctl00_dcq_tbNbMultiple_wrapper").css("display","inline-block"),$(".trBareme").hide(),$(".cbBareme input").prop("checked",!1))}),$(".cbMultiple input").change(),$(".cbBareme input").change(function(){ShowHide($(".cbBareme input"),$(".trBareme")),$(".cbBareme input").is(":checked")&&($(".trMultiple").hide(),$(".cbMultiple input").prop("checked",!1))}),$(".cbBareme input").change(),$(".ddlBareme").change(function(){$(".ddlBareme option:selected").val()=="2"?$(".btnSetWeights").show():$(".btnSetWeights").hide()}),$(".ddlBareme").change(),$(".popup_texte").click(function(){$(".validation").slideUp("slow")}),$(".validation").click(function(){$(".validation").slideUp("slow")}),$("input").keypress(function(n){if(n.which==13)return!1;n.which==13&&n.preventDefault()}),LoadMods(),LoadGroupNum(),$(".cbOtherPrecise").attr("shakerdisabled")&&showLimitOnElemClick(".cbOtherPrecise",!0),$(".cbRestriction").attr("shakerdisabled")&&showLimitOnElemClick(".cbRestriction",!0),$(".cbMandatory").attr("shakerdisabled")&&showLimitOnElemClick(".cbMandatory",!0),$(".cbRandom").attr("shakerdisabled")&&showLimitOnElemClick(".cbRandom",!0),$(".cbAlphaOrder").attr("shakerdisabled")&&showLimitOnElemClick(".cbAlphaOrder",!0),$(".cbAlert").attr("shakerdisabled")&&showLimitOnElemClick(".cbAlert",!0),$(".ddlfillIcon").length>0&&$(".ddlfillIcon").DropDownFillIcons(),LoadGroup(!1),LoadPictos(),$(".ddlPictos").length>0&&($(".ddlPictos").DropDownPictos(),i="",$("p.sphDdl").find("img").each(function(){i+=$(this).attr("src")+";"}),$(".hdnPictos").val(i),$("#Group").length>0?BuildPredefinedModalitiesTabPicto():BuildPredefinedModalitiesPicto()),n=$("#popup"),$("li div.k-thumb","#selectable").draggable({scope:"tasks",distance:10,revert:"invalid",containment:[n.offset().left,n.offset().top,n.offset().left+n.width(),n.offset().top+n.height()],helper:function(n){var i=$("<div class='drag-img'></div>"),r=$(".ui-selected");return r.length>0?$(".ui-selected").each(function(){i.append($(this).clone())}):i.append($(n.currentTarget).clone()),i},cursor:"move",start:function(){$(this).hasClass("ui-selected")?selected=$(".ui-selected").each(function(){var n=$(this).clone();n.data("offset",n.offset())}):(selected=$([]),$("#selectable > li").removeClass("ui-selected")),offset=$(this).offset()}}),$("#selectable").selectable(),$("#selectable > li").click(function(n){n.ctrlKey?$(this).hasClass("ui-selected")?$(this).removeClass("ui-selected"):$(this).addClass("ui-selecting"):($("#selectable > li").removeClass("ui-selected"),$(this).addClass("ui-selecting")),$("#selectable").data("uiSelectable")._mouseStop(null)}),SetVisibleImageGallery(),$("#popup_options").scroll(function(){SetVisibleImageGallery()}),$(".lnkImgGallery").click(function(){var n=GetRadWindow().get_windowManager();return n.open("windows/ImageGallery.aspx?rnd="+Math.floor(Math.random()*11)+"&session=igs_winImageModalities&BackGdColor=FDFDFD","wndImageGallery"),!1}),isNameContentOpened?$("#nameContent").show():$("#nameContent").hide();$("#nameToggle").off("click").on("click",function(){isNameContentOpened=!isNameContentOpened,$("#nameContent").slideToggle(500),$("#ctl00_dcq_nameToggleImg").toggle()})}function ddlType_SelectedIndexChanged(){typeChanged=!0}function SetVisibleImageGallery(){var t=$("#selectable span.k-loading"),n=0;t.each(function(){if($(this).visible(!1,!0)){var t="<img alt='"+$(this).data("name")+"' style='max-width:100%;max-height:100%;' ondragstart='return false;' src='"+$(this).data("url")+"' />";$(this).parent().html(t),n++}})}function refreshImageGallery(){radAjaxRequest("")}function lnkRestrictions_ClientClick(){var r="FR",f=document.getElementById("hdnLgSurvey"),t,i,u;f&&(r=f.value),t=r,i=document.getElementById("hdnLgInter"),i&&(t=i.value),u=GetRadWindow().get_windowManager(),u.open("windows/SampleDefinition.aspx?rnd="+Math.floor(Math.random()*11)+"&BackGdColor=FDFDFD&UseLabel=1&lang="+r+"&linter="+t+"&OnOk=Restrict_OnOk&OnCancel=Restrict_OnCancel&sampletype=conception","wndSampleDefinition")}function ShowJumps(n){var t=GetRadWindow().get_windowManager();t.open("windows/JumpDefinition.aspx?rnd="+Math.floor(Math.random()*11)+"&addforid="+n,"wndJumps")}function ShowCalcVar(){var n=GetRadWindow().get_windowManager();n.open("windows/BasicDefinition.aspx?rnd="+Math.floor(Math.random()*11),"wndBasicDefinition")}function setSample(n){$(".hdnRestriction").val(n),radAjaxRequest("RESTRICTION:"+n)}function setBasic(){radAjaxRequest("BASIC")}function ShowSetWeights(){var n=GetRadWindow().get_windowManager();n.open("windows/creation/setweights.aspx?rnd="+Math.floor(Math.random()*11)+"&"+GetLnkWeightsArgs(),"wndEditWeights")}function ShowManageDictionaries(){var t=GetRadWindow().get_windowManager(),n="&dictionaries="+Base64.encode($(".hdnQualiDictionaries").val());t.open("windows/creation/manageQualiDictionaries.aspx?rnd="+Math.floor(Math.random()*11)+n,"wndManageQualiDictionaries")}function ShowSetScales(n){var t=GetRadWindow().get_windowManager();t.open("windows/creation/scales.aspx?rnd="+Math.floor(Math.random()*11)+"&isgroup="+n,"wndScales")}function GetLnkWeightsArgs(){var n=Base64.encode(GetMods());return"mods="+n+"&weights="+$(".hdnWeights").val()}function GetMods(){var t="",n=GetDdlType().get_value();return t=n=="smiley"||n=="image"?$("#ctl00_dcq_pictos_lspictomods").val():n=="caseacocher"||n=="menuderoulant"||n=="echellegraduee"||n=="echellenumerotee"||n=="fillicon"||n=="buttoncolors"||n=="postit"||n=="rating"?$("#ctl00_dcq_mods_lsmods").val():$(".groupTab #ctl00_dcq_group_lsmods").val()}function setPictos(n,t){$(".hdnPictos").val(n),$(".hdnPictosSize").val(t),$(".hdnPictosIndex").val(0),$("div.sphDdlContent div").eq(0).html(BuildDivPictos($(".hdnPictos").val())),$("p.sphDdl").html($("div.sphDdlContent div").eq(0).html()),$("p.sphDdl").find("img").each(function(){$(this).attr("height","19")}),CheckSize()}function txtLibelleOnClientLoad(n){if($.browser.msie||/Trident\/7\./.test(navigator.userAgent)){var i=function(){$(".hdnLibelle").val(n.get_html(!0))};n.attachEventHandler("mouseover",i),n.attachEventHandler("mouseleave",i),n.attachEventHandler("onkeyup",i)}}function checkNeedConfirm(){var i=document.getElementById("hdnRecordsCount"),t=document.getElementById("hdnIsNewQuestion"),n=parseInt(i.value,10);return n>0&&t.value==="0"&&(modalityDeleted||typeChanged)?confirm(confirmMsg())?(modalityDeleted=!1,typeChanged=!1,!0):!1:!0}function pageLoad(){createQuestionLoadHandler(),$(".t_right").tipsy({gravity:"w"}),$(".t_bottom").tipsy({gravity:"n"})}var isNameContentOpened=!1,modalityDeleted=!1,typeChanged=!1,selected=$([]);function LoadMods(){$(".modalitieList").modalitieList()}(function(n){n.fn.modalitieList=function(){function r(){n(".modalitieList ul").find("li").each(function(){n(this).find(".mod").val()==""?(e(n(this)),n(this).remove()):(index=parseInt(n(this).index()+1),n(this).find(".mod").attr("name","mod"+index),n(this).find(".oldindex").attr("name","oldindex"+index))}),n(".modalitieList ul").find("li:last-child").find(".mod").val()!=""&&i("")}function e(n){n.is(":last-child")||n.find(".oldindex").val()==="-1"||(modalityDeleted=!0)}function f(){var t="";n(".modalitieList ul").find("li").each(function(){t+=n(this).find(".oldindex").val()+"|"+n(this).find(".mod").val()+";"}),n(".modalitieList #ctl00_dcq_mods_lsmods").val(t)}function u(){var t=50*n("li").length;n(".modalitieList").scrollTop(t)}function i(t){var a=n(".modalitieList ul");n(a).append("<li></li>"),n(".addValue").val("");var o=n(a).find("li:last-child"),c=n(o).parent().children().length,l=c,h="",s=t.split("|");s.length>=2?(l=s[0],h=s[1]):(l=-1,h=s[0]),n(o).html("<input type='text' class='mod ignore' name='mod"+c+"' style='width:510px;' />"),n(o).append("<input type='hidden' class='oldindex' name='oldindex"+c+"' />"),n(o).find(".mod").val(h),n(o).find(".oldindex").val(l),n(o).append('<img class="del" src="../../../img/popup/picto_supprimer.png" />'),n(o).append('<img class="drag" src="../../../img/popup/picto_grab.png" />'),n(o).find(".del").click(function(){n(this).parents("li").is(":last-child")&&n(this).val()==""||(e(n(this).closest("li")),n(this).parents("li").remove(),r(),f())}),n(o).find(".mod").keypress(function(t){if(t.which==13)return n(this).parents("li").next().find(".mod").focus(),!1;t.which==13&&t.preventDefault()}),n(o).find(".mod").bind("keyup",function(){var o,f,e;if(n(this).parents("li").is(":last-child")&&n(this).val()!=""&&(i(""),u()),o=n(this).val(),o=o.replace(/\t/g,";"),f=o.split(";"),f.length>1){for(n(this).val(f[0]),e=1;e<f.length;e++)i(f[e]);r(),u()}}),n(o).find(".mod").bind("change",function(){var o,f,e;if(n(this).parents("li").is(":last-child")&&n(this).val()!=""&&(i(""),u()),o=n(this).val(),o=o.replace(/\t/g,";"),f=o.split(";"),f.length>1){for(n(this).val(f[0]),e=1;e<f.length;e++)i(f[e]);r(),u()}}),n(o).find(".mod").bind("blur",function(){n(this).val()==""&&r(),f()})}return this.each(function(){var e,o,t;for(n(this).find("ul").length==0&&n(this).prepend("<ul></ul>"),e=n(this).find("ul"),n(e).sortable({axis:"y",helper:"clone",containment:".modalitieList",handle:".drag",placeholder:"ui-ph",zIndex:1e4,stop:function(){r(),f()}}),n(e).after("<div class='add'><input class='addValue' /><span class='addBtn'></span></div>"),n(".addBtn").click(function(){i(n(".addValue").val()),u()}),n(e).html(""),o=n(".modalitieList #ctl00_dcq_mods_lsmods").val().split(";"),t=0;t<o.length;t++)i(o[t]);n(".modalitieList").scrollTop(0),r()}),this}})(jQuery);function LoadPictos(){$(".pictosList").pictosList()}function BuildPredefinedModalitiesPicto(){var u,r,i;if($(".ddlPictos").length>0){u="",$("p.sphDdl").find("img").each(function(){u+=$(this).attr("src")+";"}),$(".hdnPictos").val(u);var t=$(".hdnPictos").val().split(";"),e=$(".pictosList ul li:not(:last-child)"),f=e.length,n=[];switch(f){case 1:case 5:n=t;break;case 2:n.push(t[0]),n.push(t[4]);break;case 3:n.push(t[0]),n.push(t[2]),n.push(t[4]);break;case 4:n.push(t[0]),n.push(t[1]),n.push(t[3]),n.push(t[4]);break;default:for(n.push(t[0]),n.push(t[1]),r=0;r<f-4;r++)n.push(t[2]);n.push(t[3]),n.push(t[4])}i=0,e.each(function(){var t=$(this).find(".droppable"),r;t.find("img").remove(),n[i]!=null&&(t.parent().find(".pictourl").val(n[i]),r="<img style='max-width:100%;max-height:100%;' src='"+n[i]+"' />",$(r).appendTo(t)),i++})}}function BuildPersonalizedModalitiesPicto(){if($(".hdnPictos").val()!==""){var t=$(".hdnPictos").val().split(";"),i=$(".pictosList ul li:not(:last-child)"),n=0;i.each(function(){var i=$(this).find(".droppable"),r;i.find("img").remove(),t[n]!=null&&(i.parent().find(".pictourl").val(t[n]),r="<img style='max-width:100%;max-height:100%;' src='"+t[n]+"' />",$(r).appendTo(i)),n++})}}(function(n){n.fn.pictosList=function(){function r(){n(".pictosList ul").find("li").each(function(){var i=n(this).find(".mod").val()=="",t;i&&n(this).find(".droppable img").length>0&&(t=n(this).find(".droppable img").attr("alt"),t!=null&&t!==""&&(n(this).find(".mod").val(t),i=!1)),i?(e(n(this)),n(this).remove()):(index=parseInt(n(this).index()+1),n(this).find(".mod").attr("name","mod"+index),n(this).find(".pictourl").attr("name","pictourl"+index),n(this).find(".oldindex").attr("name","oldindex"+index))}),n(".pictosList ul").find("li:last-child").find(".mod").val()!=""&&i(""),BuildPredefinedModalitiesPicto()}function e(n){n.is(":last-child")||n.find(".oldindex").val()==="-1"||(modalityDeleted=!0)}function f(){var i="",t="";n(".pictosList ul").find("li").each(function(){i+=n(this).find(".oldindex").val()+"|"+n(this).find(".mod").val()+";",t+=n(this).find(".droppable img").attr("src")+";"}),n(".pictosList #ctl00_dcq_pictos_lspictomods").val(i),n(".hdnPictos").val(t)}function u(){var t=50*n("li").length;n(".pictosList").parent().scrollTop(t)}function i(t){var a=n(".pictosList ul");n(a).append("<li></li>"),n(".addValue").val("");var o=n(a).find("li:last-child"),h=o.parent().children().length,l=h,c="",s=t.split("|");s.length>=2?(l=s[0],c=s[1]):(l=-1,c=s[0]),o.html("<table style='border-collapse: separate; border-spacing: 4px;'><tr><td><div class='droppable'></div><input type='hidden' class='pictourl' name='pictourl"+h+"' /></td></tr></table>"),o.find("td").append("<input type='hidden' class='oldindex' name='oldindex"+h+"' />"),o.find(".oldindex").val(l),o.find("tr").append("<td><input type='text' class='mod ignore' name='mod"+h+"' style='width:400px;' /></td>"),o.find(".mod").val(c),o.find("tr").append('<td><img class="del" src="../../../img/popup/picto_supprimer.png" /></td>'),o.find("tr").append('<td><img class="drag" src="../../../img/popup/picto_grab.png" /></td>'),BuildPredefinedModalitiesPicto(),o.find(".del").click(function(){n(this).parents("li").is(":last-child")&&n(this).val()==""||(e(n(this).closest("li")),n(this).parents("li").remove(),r(),f())}),o.find(".mod").keypress(function(t){if(t.which==13)return n(this).parents("li").next().find(".mod").focus(),!1;t.which==13&&t.preventDefault()}).bind("keyup",function(){var o,f,e;if(n(this).parents("li").is(":last-child")&&n(this).val()!=""&&(i(""),BuildPredefinedModalitiesPicto(),u()),o=n(this).val(),o=o.replace(/\t/g,";"),f=o.split(";"),f.length>1){for(n(this).val(f[0]),e=1;e<f.length;e++)i(f[e]);r(),u()}}).bind("change",function(){var o,f,e;if(n(this).parents("li").is(":last-child")&&n(this).val()!=""&&(i(""),u()),o=n(this).val(),o=o.replace(/\t/g,";"),f=o.split(";"),f.length>1){for(n(this).val(f[0]),e=1;e<f.length;e++)i(f[e]);r(),u()}}).bind("blur",function(){n(this).val()==""&&r(),f()}),o.droppable({scope:"tasks",tolerance:"pointer",activeClass:"ui-state-highlight",drop:function(t,r){for(var c=r.helper.find("img"),l=c.length,e=n(this),o,h,s=0;s<l;s++)o=n(c.get(s)),h=e.find(".droppable"),h.find("img").remove(),o.clone().appendTo(h),h.parent().find(".pictourl").val(o.attr("src")),e.find(".mod").val()==""&&(e.find(".mod").val(o.attr("alt")),i(""),u()),e=e.next();f()}})}return this.each(function(){var u,e,t;for(n(this).find("ul").length==0&&n(this).prepend("<ul></ul>"),u=n(this).find("ul"),n(u).sortable({tolerance:"pointer",items:"li:not(:last-child)",containment:".pictosList",handle:".drag",zIndex:1e4,stop:function(){r(),f()}}),n(u).html(""),e=n(".pictosList #ctl00_dcq_pictos_lspictomods").val().split(";"),t=0;t<e.length;t++)i(e[t]);n(".pictosList").scrollTop(0),r(),n(".ddlPictos").length>0?BuildPredefinedModalitiesPicto():BuildPersonalizedModalitiesPicto()}),this}})(jQuery);function LoadGroup(n){$(".groupTab").groupTab(n)}function BuildPredefinedModalitiesTabPicto(){var u,r,i;if($(".ddlPictos").length>0){u="",$("p.sphDdl").find("img").each(function(){u+=$(this).attr("src")+";"}),$(".hdnPictos").val(u);var t=$(".hdnPictos").val().split(";"),e=$(".groupTab #modsGroup>thead>tr th:not(:last-child)"),f=e.length,n=[];switch(f){case 1:case 5:n=t;break;case 2:n.push(t[0]),n.push(t[4]);break;case 3:n.push(t[0]),n.push(t[2]),n.push(t[4]);break;case 4:n.push(t[0]),n.push(t[1]),n.push(t[3]),n.push(t[4]);break;default:for(n.push(t[0]),n.push(t[1]),r=0;r<f-4;r++)n.push(t[2]);n.push(t[3]),n.push(t[4])}i=0,e.each(function(){var t=$(this).find(".droppable"),r;t.find("img").remove(),n[i]!=null&&(t.parent().find(".pictourl").val(n[i]),r="<img style='max-width:100%;max-height:100%;' src='"+n[i]+"' />",$(r).appendTo(t)),i++})}}function BuildPersonalizedModalitiesTabPicto(){if($(".hdnPictos").val()!==""){var t=$(".hdnPictos").val().split(";"),i=$(".groupTab #modsGroup>thead>tr th:not(:last-child)"),n=0;i.each(function(){var i=$(this).find(".droppable"),r;i.find("img").remove(),t[n]!=null&&(i.parent().find(".pictourl").val(t[n]),r="<img style='max-width:100%;max-height:100%;' src='"+t[n]+"' />",$(r).appendTo(i)),n++})}}(function(n){n.fn.groupTab=function(t){function e(){n(".groupTab li").each(function(){n(this).find(".oldindex").val(n(this).prevAll().length)}),n(".groupTab #modsGroup>thead>tr th").each(function(){index=parseInt(n(this).index()-1),n(this).find(".mod").attr("name","mod"+index),n(this).find(".oldindex").attr("name","oldindexmod"+index)}),BuildPredefinedModalitiesTabPicto()}function v(t){var i=n(t).find(".oldindex"),r=i.val();return i.val(n(t).prevAll().length),r}function o(t){var i=n(".groupTab .lsactions").val();t.action=="move"?n(".groupTab .lsactions").val(i+"0:"+t.oldindex+":"+t.newindex+";"):t.action=="delete"?n(".groupTab .lsactions").val(i+"1:"+t.index+";"):t.action=="create"&&n(".groupTab .lsactions").val(i+"2;")}function a(n){n.is(":last-child")||n.find(".oldindex").val()==="-1"||(modalityDeleted=!0)}function i(){n(".groupTab #modsGroup>thead>tr th").each(function(){n(this).is(":last-child")||n(this).find(".mod").val()!=""||(a(n(this)),n(this).remove(),n(".groupTab #modsGroup>tbody>tr td:last-child").each(function(){n(this).remove()}))}),n(".groupTab #modsGroup>thead>tr th:last-child .mod").val()!=""&&r(""),n(".groupTab li").each(function(){n(this).is(":last-child")||n(this).find(".item").val()!=""||(o({action:"delete",index:n(this).prevAll().length}),n(this).remove())}),n(".groupTab li:last-child .item").val()!=""&&u(""),e()}function c(){var t="";n(".groupTab #itemsGroup li").each(function(){t+=n(this).find(".oldindex").val()+"|"+n(this).find(".item").val()+";"}),n(".groupTab .lsitems").val(t)}function h(){var i="",t="";n(".groupTab #modsGroup>thead>tr th").each(function(){i+=n(this).find(".oldindex").val()+"|"+n(this).find(".mod").val()+";",t+=n(this).find(".droppable img").attr("src")+";"}),n(".groupTab .lsmods").val(i),n(".hdnPictos").val(t)}function r(t){var y=n(".groupTab #modsGroup>thead>tr");y.append('<th class="thMod"><table style="border-collapse: separate; border-spacing: 4px;"><tr></tr></table></th>'),n(".addMod").val("");var u=y.find("th:last-child > table tr"),l=u.closest("th.thMod").children().length-1,v=l,c="",o=t.split("|");o.length>=2?(v=o[0],c=o[1]):(v=-1,c=o[0]),u.html(""),f&&u.append("<td><div class='droppable' /><input type='hidden' class='pictourl' name='pictourl' /></td>"),u.append("<td><input type='text' class='mod noEnterSubmit ShakerInput ignore' name='mod"+l+"' size='15' style='width:140px;' /><img class='del' src='../../../img/popup/picto_supprimer.png' /></td>").append("<input type='hidden' class='oldindex' name='oldindexmod"+l+"' />").find(".mod").val(c).end().find(".oldindex").val(v).end(),BuildPredefinedModalitiesTabPicto(),n(".groupTab #modsGroup>tbody>tr").each(function(){n(this).append('<td class="tdalign"><input type="radio" disabled="disabled" /></td>')}),u.find(".del").click(function(){n(this).parents("th.thMod").is(":last-child")&&n(this).val()==""||(a(n(this).closest("th.thMod")),n(this).parents("th.thMod").remove(),n(".groupTab #modsGroup tbody tr td:last-child").each(function(){n(this).remove()}),e(),h())}),u.find(".mod").keypress(function(t){if(t.which==13)return n(this).parents("th.thMod").next().find(".mod").focus(),!1;t.which==13&&t.preventDefault()}).bind("keyup",function(){var e,u,f;if(n(this).parents("th.thMod").is(":last-child")&&n(this).val()!=""&&(r(""),BuildPredefinedModalitiesTabPicto(),s()),e=n(this).val(),e=e.replace(/\t/g,";"),u=e.split(";"),u.length>1){for(n(this).val(u[0]),f=1;f<u.length;f++)r(u[f]);i()}}).bind("change",function(){var e,u,f;if(n(this).parents("th.thMod").is(":last-child")&&n(this).val()!=""&&(r(""),s()),e=n(this).val(),e=e.replace(/\t/g,";"),u=e.split(";"),u.length>1){for(n(this).val(u[0]),f=1;f<u.length;f++)r(u[f]);i()}}).bind("blur",function(){n(this).val()==""&&i(),h()}),f&&u.closest("table").droppable({scope:"tasks",tolerance:"pointer",activeClass:"ui-state-highlight",drop:function(t,i){for(var l=i.helper.find("img"),a=l.length,u=n(this),f,c,o=0;o<a;o++)f=n(l.get(o)),c=u.find(".droppable"),c.find("img").remove(),f.clone().appendTo(c),c.parent().find(".pictourl").val(f.attr("src")),u.find(".mod").val()==""&&(u.find(".mod").val(f.attr("alt")),r(""),s()),u=u.closest(".thMod").next().find(">table");e(),h()}})}function s(){var t=50*n(".groupTab th").length;n(".groupTab").scrollLeft(t)}function l(){var t=50*n(".groupTab li").length;n(".groupTab").scrollTop(t)}function u(t){var p=n(".groupTab #itemsGroup"),r,b,w,h;p.append("<li></li>"),n(".addItem").val("");var a=p.find("li:last-child"),v=a.parent().children().length,y=v,s="",f=t.split("|");for(f.length>=2?(y=f[0],s=f[1]):(y=-1,s=f[0]),a.html("<input type='text' class='item noEnterSubmit ignore' name='item"+v+"' size='15' style='width:170px;' />").append("<input type='hidden' class='oldindex' name='oldindex"+v+"' />").find(".item").val(s).end().find(".oldindex").val(y).end().append('<img class="del" src="../../../img/popup/picto_supprimer.png" />').append('<img class="drag" src="../../../img/popup/picto_grab.png" />'),o({action:"create"}),r=n(".groupTab #modsGroup"),b=r.find(">thead th").length,r.find(">tbody").append("<tr></tr>"),w=r.find(">tbody>tr:last-child"),h=0;h<b;h++)w.append('<td class="tdalign"><input type="radio" disabled="disabled" /></td>');a.find(".del").click(function(){n(this).parents("li").is(":last-child")&&n(this).val()==""||(o({action:"delete",index:n(this).parents("li").prevAll().length}),n(this).parents("li").remove(),r.find(">tbody>tr:last-child").remove(),e(),c())}).end().find(".item").keypress(function(t){if(t.which==13)return n(this).parents("li").next().find(".item").focus(),!1;t.which==13&&t.preventDefault()}).bind("keyup",function(){var e,r,f;if(n(this).parents("li").is(":last-child")&&n(this).val()!=""&&(u(""),l()),e=n(this).val(),e=e.replace(/\t/g,";"),r=e.split(";"),r.length>1){for(n(this).val(r[0]),f=1;f<r.length;f++)u(r[f]);i()}}).bind("change",function(){var e,r,f;if(n(this).parents("li").is(":last-child")&&n(this).val()!=""&&(u(""),l()),e=n(this).val(),e=e.replace(/\t/g,";"),r=e.split(";"),r.length>1){for(n(this).val(r[0]),f=1;f<r.length;f++)u(r[f]);i()}}).bind("blur",function(){n(this).val()==""&&i(),c()})}var f=!1;return this.each(function(){var l,h,a,s,e;for((n(".ddlPictos").length>0||n(".lnkImgGallery").length>0)&&(f=!0),l=n(".groupTab .lsactions").val(),h=n(this).find("#itemsGroup"),t||(h.html(""),h.sortable({axis:"y",helper:"clone",containment:"#divItemsGroup",handle:".drag",placeholder:"ui-ph",zIndex:1e4,stop:function(n,t){o({action:"move",oldindex:v(t.item),newindex:t.item.prevAll().length}),i(),c()}}),n(h).after("<input class='addMod' />"),n(h).after("<input class='addItem' />")),a=n(this).find("#modsGroup"),a.html("<thead><tr></tr></thead><tbody></tbody>"),s=n(".groupTab .lsmods").val().split(";"),e=0;e<s.length;e++)r(s[e]);if(!t)for(s=n(".groupTab .lsitems").val().split(";"),e=0;e<s.length;e++)u(s[e]);i(),n(".groupTab").scrollTop(0),n(".groupTab").scrollLeft(0),t||n(".groupTab .lsactions").val(l),n(".ddlPictos").length>0?BuildPredefinedModalitiesTabPicto():n(".lnkImgGallery").length>0&&BuildPersonalizedModalitiesTabPicto(),f?n("#divItemsGroup").css("padding-top","91px"):n("#divItemsGroup").css("padding-top","33px")}),this}})(jQuery);function LoadGroupNum(){$(".groupNumTab").groupNumTab()}(function(n){n.fn.groupNumTab=function(){function o(){n(".groupNumTab ul li").each(function(){n(this).find(".oldindex").val(n(this).prevAll().length)})}function s(t){var i=n(t).find(".oldindex"),r=i.val();return i.val(n(t).prevAll().length),r}function f(t){var i=n(".groupNumTab .lsactions").val();t.action=="move"?n(".groupNumTab .lsactions").val(i+"0:"+t.oldindex+":"+t.newindex+";"):t.action=="delete"?n(".groupNumTab .lsactions").val(i+"1:"+t.index+";"):t.action=="create"&&n(".groupNumTab .lsactions").val(i+"2;")}function u(){n(".groupNumTab li").each(function(){n(this).is(":last-child")||n(this).find(".item").val()!=""||(f({action:"delete",index:n(this).prevAll().length}),n(this).remove())}),n(".groupNumTab li:last-child .item").val()!=""&&i(""),o()}function e(){var t="";n(".groupNumTab li").each(function(){t+=n(this).find(".oldindex").val()+"|"+n(this).find(".item").val()+";"}),n(".groupNumTab .lsitems").val(t)}function r(){var t=50*n(".groupNumTab li").length;n(".groupNumTab").scrollTop(t)}function i(t){var v=n(".groupNumTab ul");n(v).append("<li></li>"),n(".addItem").val("");var a=n(v).find("li:last-child"),c=a.parent().children().length,l=c,h="",s=t.split("|");s.length>=2?(l=s[0],h=s[1]):(l=-1,h=s[0]),a.html("<input type='text' class='item ShakerInput ignore' name='item"+c+"' size='50' style='width:580px;' />").append("<input type='hidden' class='oldindex' name='oldindex"+c+"' />").find(".item").val(h).end().find(".oldindex").val(l).end().append('<img class="del" src="../../../img/popup/picto_supprimer.png" />').append('<img class="drag" src="../../../img/popup/picto_grab.png" />'),f({action:"create"}),a.find(".del").click(function(){n(this).parents("li").is(":last-child")&&n(this).val()==""||(f({action:"delete",index:n(this).parents("li").prevAll().length}),n(this).parents("li").remove(),o(),e())}).end().find(".item").keypress(function(t){if(t.which==13)return n(this).parents("li").next().find(".item").focus(),!1;t.which==13&&t.preventDefault()}).bind("keyup",function(){var o,f,e;if(n(this).parents("li").is(":last-child")&&n(this).val()!=""&&(i(""),r()),o=n(this).val(),o=o.replace(/\t/g,";"),f=o.split(";"),f.length>1){for(n(this).val(f[0]),e=1;e<f.length;e++)i(f[e]);u(),r()}}).bind("change",function(){var o,f,e;if(n(this).parents("li").is(":last-child")&&n(this).val()!=""&&(i(""),r()),o=n(this).val(),o=o.replace(/\t/g,";"),f=o.split(";"),f.length>1){for(n(this).val(f[0]),e=1;e<f.length;e++)i(f[e]);u(),r()}}).bind("blur",function(){n(this).val()==""&&u(),e()})}return this.each(function(){var h=n(".groupNumTab #ctl00_dcq_groupNum_lsactions"),l=h.data("initialiazed"),c,t,o;if(l)return this;for(h.data("initialiazed",!0),c=h.val(),n(this).find("ul").length==0&&n(this).prepend("<ul></ul>"),t=n(this).find("ul"),n(t).sortable({axis:"y",helper:"clone",containment:".groupNumTab",handle:".drag",placeholder:"ui-ph",zIndex:1e4,stop:function(n,t){f({action:"move",oldindex:s(t.item),newindex:t.item.prevAll().length}),u(),e()}}),n(t).after("<div class='add'><input class='addMod' /><span class='addModBtn'></span></div>"),n(t).after("<div class='add'><input class='addItem' /><span class='addItemBtn'></span></div>"),n(".addItemBtn").click(function(){i(n(".addItem").val()),r()}),values=n(".groupNumTab .lsitems").val().split(";"),o=0;o<values.length;o++)i(values[o]);u(),n(".groupNumTab").scrollTop(0),n(".groupNumTab .lsactions").val(c)}),this}})(jQuery);function CheckSize(){var n=$(".hdnPictosSize").val();n=n==""||n==0||n>12?35:GetSizeInPixels(n),$("div.sphDdlContent").find("img").each(function(){$(this).attr("width",n)})}function BuildDivPictos(n){var t=n.split(";"),u=t.length,r="";for(i=0;i<u;i++)t[i]!=""&&(r+=GetImage(t[i]));return'<div class="divPictos">'+r+"</div>"}function GetImage(n){return"<img src='"+n+"' />"}function WriteLsPictos(){var n="";$(".divWeights table").find("tr:last-child").find("td").each(function(){n+=$(this).find("img").attr("src")+";"}),$(".hdnPictos").val(n)}function SetPictos_SetImage(n,t){var i=$(".selPicto").eq(n).find("img");$(i).attr("src",t),WriteLsPictos()}$.fn.DropDownPictos=function(){function r(n){$(n).find("option").each(function(){$("div.sphDdlContent").append(BuildDivPictos($(this).val()))}),$("p.sphDdl").html($("div.sphDdlContent div").eq($(".hdnPictosIndex").val()-1).html()),$("p.sphDdl").find("img").each(function(){$(this).attr({height:"19",width:"19"}).css("padding","1px")})}function i(n,t){$("p.sphDdl").html($(n).html()),$("p.sphDdl").find("img").each(function(){$(this).attr({height:"19",width:"19"}).css("padding","1px")});var i="";$(n).find("img").each(function(){i+=$(this).attr("src")+";"}),$(".hdnPictos").val(i),$(".hdnPictosIndex").val(t),$("#Group").length>0?BuildPredefinedModalitiesTabPicto():BuildPredefinedModalitiesPicto()}function t(n){var t=$("div.sphDdlContent");$(t).css("max-height","210px"),$(t).css("top",$(n).offset().top-210),$(t).css("left",$(n).offset().left+$(n).width()-t.width()),$(t).show(50)}return this.each(function(){$(this).css("display","none"),$(this).wrap('<div class="sphDdlPictos"></div>');var n=$(this).parent();$(n).append('<p class="sphDdl"></p>'),$(n).append('<div class="sphDdlContent" style="display: none"></div>'),r($(this)),$("div.sphDdlContent div").hover(function(){$(this).addClass("divPictosHover")},function(){$(this).removeClass("divPictosHover")}),$("div.sphDdlContent div").click(function(){var n=$(this).index();return i($(this),n),$(this).parent().hide(),!1}),$("div.sphDdlContent p.pHeader").click(function(){return!1}),$(".popup_texte").click(function(){$("div.sphDdlContent").hide()}),$("p.sphDdl").click(function(){return $("div.sphDdlContent").css("display")=="block"?$("div.sphDdlContent").hide():t(this),!1})}),this};function BuildDivFillIcon(n){var r="",t;for(i=0;i<5;i++)t=i>2?"unselect":"select",r+="<i class='fs-fillicon "+n+"-"+t+"'></i>";return'<div class="divFillIcon '+n+'" icon-value="'+n+'">'+r+"</div>"}$.fn.DropDownFillIcons=function(){function r(n){$(n).find("option").each(function(){$("div.sphDdlContentFillIcon").append(BuildDivFillIcon($(this).val()))}),$("p.sphDdlFillIcon").html($("div.divFillIcon."+$(".sphDdlFillIcon select").val()).html())}function i(n){$("p.sphDdlFillIcon").html($(n).html()),$("select.ddlfillIcon").val($(n).attr("icon-value"))}function t(){var t=$("div.sphDdlContentFillIcon");$(t).show(50)}return this.each(function(){$(this).css("display","none"),$(this).wrap('<div class="sphDdlFillIcon"></div>');var n=$(this).parent();$(n).append('<p class="sphDdlFillIcon" style="font-size:24px;height:25px;"></p>'),$(n).append('<div class="sphDdlContentFillIcon" style="display: none"></div>'),r($(this)),$("div.sphDdlContentFillIcon div").hover(function(){$(this).addClass("divPictosHover")},function(){$(this).removeClass("divPictosHover")}),$("div.sphDdlContentFillIcon div").click(function(){var n=$(this).index();return i($(this),n),$(this).parent().hide(),!1}),$("p.sphDdlFillIcon").click(function(){return $("div.sphDdlContentFillIcon").css("display")=="block"?$("div.sphDdlContentFillIcon").hide():t(this),!1}),$(".popup_texte").click(function(){$("div.sphDdlContentFillIcon").hide()})}),this};